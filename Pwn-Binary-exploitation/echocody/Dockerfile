FROM ubuntu:18.04

LABEL maintainer="ovior"
LABEL description="echocody challenge"

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    gcc \
    make \
    socat \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /challenge

COPY echocody.c /challenge/
COPY flag /
COPY run.sh /challenge/

RUN gcc echocody.c -Wl,-z,noseparate-code -Wno-implicit-function-declaration -no-pie -DNOPIE -o echocody

RUN chmod +x run.sh
RUN chmod 444 /flag
RUN chown -R root:root /challenge

EXPOSE 1337

ENV FLAG=cst{N0w_7RY_70_Wr173_70_5h}

CMD ["./run.sh"]
